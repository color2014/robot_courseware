



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="相机标定 物体检测 3d相机原理 双目相机 结构光相机 TOF相机 三维扫描仪 3D相机编程 相机标定 去畸变 位姿估计 三维重建 相机模型 小孔成像模型">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>02-直线检测 - 黑马机器人 | 相机标定&物体检测</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#02-" tabindex="0" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <!-- <a href="../.." title="黑马机器人 | 相机标定&物体检测" aria-label="黑马机器人 | 相机标定&物体检测" class="md-header-nav__button md-logo"> -->
        <a href="/docs" title="黑马机器人 | 相机标定&物体检测" aria-label="黑马机器人 | 相机标定&物体检测" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              <a href="../..">黑马机器人 | 相机标定&物体检测</a>
            </span>
            <span class="md-header-nav__topic">
              
                02-直线检测
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer" style="display: none;">
    <a href="../.." title="黑马机器人 | 相机标定&物体检测" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    黑马机器人 | 相机标定&物体检测
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      一、相机基础知识
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        一、相机基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/" title="学习目标" class="md-nav__link">
      学习目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/01-camera/" title="01-相机基础" class="md-nav__link">
      01-相机基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/02-3D_camera/" title="02-3D相机及分类" class="md-nav__link">
      02-3D相机及分类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/03-pinhole_camera_model/" title="03-相机模型" class="md-nav__link">
      03-相机模型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/04-coordinates/" title="04-坐标变换" class="md-nav__link">
      04-坐标变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/05-distortions/" title="05-相机透镜及畸变" class="md-nav__link">
      05-相机透镜及畸变
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter01/06-undistortion/" title="06-相机标定与去畸变" class="md-nav__link">
      06-相机标定与去畸变
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      二、相机标定&去畸变
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        二、相机标定&去畸变
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter02/" title="学习目标" class="md-nav__link">
      学习目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter02/01-calibration_board/" title="01-相机标定&标定板" class="md-nav__link">
      01-相机标定&标定板
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter02/02-calibration_camera/" title="02-标定实现" class="md-nav__link">
      02-标定实现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter02/03-undistortion/" title="03-去畸变(矫正)" class="md-nav__link">
      03-去畸变(矫正)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter02/04-pose_estimation/" title="04-位置估计及3D重建" class="md-nav__link">
      04-位置估计及3D重建
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter02/exercise/" title="作业" class="md-nav__link">
      作业
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      三、双目相机原理与应用
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        三、双目相机原理与应用
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter03/" title="学习目标" class="md-nav__link">
      学习目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter03/01-stereo_theory/" title="01-双目相机原理" class="md-nav__link">
      01-双目相机原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter03/02-stereo_drivers/" title="02-双目相机驱动" class="md-nav__link">
      02-双目相机驱动
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter03/03-stereo_calibration/" title="03-双目相机标定" class="md-nav__link">
      03-双目相机标定
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter03/04-stereo_point_cloud/" title="04-双目相机生成点云" class="md-nav__link">
      04-双目相机生成点云
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../chapter03/05-stereo_other/" title="05-其他操作" class="md-nav__link">
      05-其他操作
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      四、2D图像处理实战
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        四、2D图像处理实战
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="学习目标" class="md-nav__link">
      学习目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../01-obj_detect/" title="01-物体检测概述" class="md-nav__link">
      01-物体检测概述
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        02-直线检测
      </label>
    
    <a href="./" title="02-直线检测" class="md-nav__link md-nav__link--active">
      02-直线检测
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    初始化环境
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    进行图片优化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    提取边缘
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roi" class="md-nav__link">
    保留感兴趣区域ROI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    霍夫直线检测目标直线
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fld" class="md-nav__link">
    FLD直线检测
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03-box_detect/" title="03-牙膏盒检测" class="md-nav__link">
      03-牙膏盒检测
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04-common_detect/" title="04-多阈值检测多边形" class="md-nav__link">
      04-多阈值检测多边形
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../05-template_match/" title="05-模板匹配多个物体" class="md-nav__link">
      05-模板匹配多个物体
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06-feature_detection_description/" title="06-特征检测及描述" class="md-nav__link">
      06-特征检测及描述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../07-corner_detection/" title="07-角点检测" class="md-nav__link">
      07-角点检测
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../07-feature_detection/" title="07-实现特征检测及描述" class="md-nav__link">
      07-实现特征检测及描述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../08-feature_matching/" title="08-特征匹配" class="md-nav__link">
      08-特征匹配
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../09-feature_matching2/" title="09-使用特征匹配查找目标" class="md-nav__link">
      09-使用特征匹配查找目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10-feature_matching3/" title="10-特征匹配恢复目标" class="md-nav__link">
      10-特征匹配恢复目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../exercise/" title="作业&练习" class="md-nav__link">
      作业&练习
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      附录：相关开发环境
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        附录：相关开发环境
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../env/" title="前言" class="md-nav__link">
      前言
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../env/01-opencv/" title="编译安装OpenCV依赖库" class="md-nav__link">
      编译安装OpenCV依赖库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../env/02-CMakeLists/" title="CMakeLists配置模板" class="md-nav__link">
      CMakeLists配置模板
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    初始化环境
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    进行图片优化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    提取边缘
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roi" class="md-nav__link">
    保留感兴趣区域ROI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    霍夫直线检测目标直线
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fld" class="md-nav__link">
    FLD直线检测
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="02-">02-直线检测<a class="headerlink" href="#02-" title="Permanent link">&para;</a></h1>
<ul>
<li>实现思路</li>
<li>优化图片</li>
<li>Canny算子提取边缘</li>
<li>裁剪图片，保留感兴趣区域</li>
<li>最终通过霍夫直线检测目标直线</li>
</ul>
<h2 id="_1">初始化环境<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>导入依赖，并加载图片</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="c1"># 行内的形式显示图片</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;images/pic9.png&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../assets/output_2_1.png" /></p>
<h2 id="_2">进行图片优化<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<blockquote>
<p>通过使用图片处理技术，抹去细节保留边缘</p>
</blockquote>
<ul>
<li>备选方案有：</li>
<li>形态学操作 morphologyEx</li>
<li>均值滤波 pyrMeanShiftFiltering</li>
<li>中值模糊 medianBlur</li>
<li>双边滤波 bilateralFilter</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">pyrMeanShiftFiltering</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="c1"># img2 = cv2.medianBlur(img, 5)</span>
<span class="c1"># img2 = cv2.bilateralFilter(img, 0, 30, 20)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img2</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../assets/output_4_1.png" /></p>
<h2 id="_3">提取边缘<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<blockquote>
<p>使用Canny算子设置 lower threshold, upper threshold提取边缘</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">lower</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">upper</span> <span class="o">=</span> <span class="mi">255</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../assets/output_6_1.png" /></p>
<h2 id="roi">保留感兴趣区域ROI<a class="headerlink" href="#roi" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">roi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">600</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">600</span><span class="p">,</span> <span class="mi">320</span><span class="p">],[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">320</span><span class="p">]</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="c1"># 创建纯黑的原图掩膜</span>
<span class="n">roi_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">w</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="c1"># 填充ROI掩膜，将感兴趣区域填充成白色</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">roi_mask</span><span class="p">,</span> <span class="p">[</span><span class="n">roi</span><span class="p">],</span> <span class="mi">255</span><span class="p">)</span>
<span class="c1"># 通过像素位与操作保留刚刚掩膜中白色的区域</span>
<span class="n">img_roi</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">roi_mask</span><span class="p">)</span>

<span class="c1"># 显示掩膜、提取后的图片</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;roi_mask&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">roi_mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;img_roi&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_roi</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../assets/output_8_1.png" /></p>
<h2 id="_4">霍夫直线检测目标直线<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># ρ 霍夫变量，定义检测分辨率 1像素</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># θ 霍夫变量，定义检测分辨率 1度</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<span class="c1"># 在霍夫空间找到一根直线所需最小相交数的阈值</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">20</span>
<span class="c1"># 线条的最小长度</span>
<span class="n">min_line_length</span> <span class="o">=</span> <span class="mi">17</span>
<span class="c1"># 线条分段之间的最大距离</span>
<span class="n">max_line_gap</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLinesP</span><span class="p">(</span><span class="n">img_roi</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                        <span class="n">lines</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                        <span class="n">minLineLength</span><span class="o">=</span><span class="n">min_line_length</span><span class="p">,</span>
                        <span class="n">maxLineGap</span><span class="o">=</span><span class="n">max_line_gap</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">rst</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">rst</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No line&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</code></pre></div>

<p><img alt="png" src="../assets/output_10_1.png" /></p>
<h2 id="fld">FLD直线检测<a class="headerlink" href="#fld" title="Permanent link">&para;</a></h2>
<p>在OpenCV可扩充包的<code>ximgproc</code>模块中，提供了FLD快速直线检测工具（FastLineDetector）。</p>
<ul>
<li>原图及结果如下</li>
</ul>
<p><img alt="src" src="../assets/sudoku.jpg" /></p>
<p><img alt="dst" src="../assets/sudoku_lines.png" /></p>
<ul>
<li>检测代码及输出</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;opencv2/imgproc.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/ximgproc.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/imgcodecs.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/highgui.hpp&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="o">::</span><span class="n">ximgproc</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">CommandLineParser</span> <span class="n">parser</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">&quot;{@input|data/sudoku.jpg|input image}{help h||show help message}&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">parser</span><span class="p">.</span><span class="n">printMessage</span><span class="p">();</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">in</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;@input&quot;</span><span class="p">);</span>

    <span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Create FLD detector</span>
    <span class="c1">// Param               Default value   Description</span>
    <span class="c1">// length_threshold    10            - Segments shorter than this will be discarded</span>
    <span class="c1">// distance_threshold  1.41421356    - A point placed from a hypothesis line</span>
    <span class="c1">//                                     segment farther than this will be</span>
    <span class="c1">//                                     regarded as an outlier</span>
    <span class="c1">// canny_th1           50            - First threshold for</span>
    <span class="c1">//                                     hysteresis procedure in Canny()</span>
    <span class="c1">// canny_th2           50            - Second threshold for</span>
    <span class="c1">//                                     hysteresis procedure in Canny()</span>
    <span class="c1">// canny_aperture_size 3             - Aperturesize for the sobel</span>
    <span class="c1">//                                     operator in Canny()</span>
    <span class="c1">// do_merge            false         - If true, incremental merging of segments</span>
    <span class="c1">//                                     will be perfomred</span>
    <span class="kt">int</span> <span class="n">length_threshold</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">distance_threshold</span> <span class="o">=</span> <span class="mf">1.41421356f</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">canny_th1</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">canny_th2</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">canny_aperture_size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">do_merge</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FastLineDetector</span><span class="o">&gt;</span> <span class="n">fld</span> <span class="o">=</span> <span class="n">createFastLineDetector</span><span class="p">(</span><span class="n">length_threshold</span><span class="p">,</span>
                                                       <span class="n">distance_threshold</span><span class="p">,</span> <span class="n">canny_th1</span><span class="p">,</span> <span class="n">canny_th2</span><span class="p">,</span> <span class="n">canny_aperture_size</span><span class="p">,</span>
                                                       <span class="n">do_merge</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Vec4f</span><span class="o">&gt;</span> <span class="n">lines_fld</span><span class="p">;</span>

    <span class="c1">// Because of some CPU&#39;s power strategy, it seems that the first running of</span>
    <span class="c1">// an algorithm takes much longer. So here we run the algorithm 10 times</span>
    <span class="c1">// to see the algorithm&#39;s processing time with sufficiently warmed-up</span>
    <span class="c1">// CPU performance.</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">run_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">run_count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">run_count</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">freq</span> <span class="o">=</span> <span class="n">getTickFrequency</span><span class="p">();</span>
        <span class="n">lines_fld</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">int64</span> <span class="n">start</span> <span class="o">=</span> <span class="n">getTickCount</span><span class="p">();</span>
        <span class="c1">// Detect the lines with FLD</span>
        <span class="n">fld</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lines_fld</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">duration_ms</span> <span class="o">=</span> <span class="kt">double</span><span class="p">(</span><span class="n">getTickCount</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">freq</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Elapsed time for FLD &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">duration_ms</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ms.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Show found lines with FLD</span>
    <span class="n">Mat</span> <span class="n">line_image_fld</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
    <span class="n">fld</span><span class="o">-&gt;</span><span class="n">drawSegments</span><span class="p">(</span><span class="n">line_image_fld</span><span class="p">,</span> <span class="n">lines_fld</span><span class="p">);</span>
    <span class="n">imshow</span><span class="p">(</span><span class="s">&quot;FLD result&quot;</span><span class="p">,</span> <span class="n">line_image_fld</span><span class="p">);</span>

    <span class="n">waitKey</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>output:</p>
<div class="highlight"><pre><span></span><code>Elapsed time for FLD 10.8044 ms.
Elapsed time for FLD 10.2062 ms.
Elapsed time for FLD 11.273 ms.
Elapsed time for FLD 10.8076 ms.
Elapsed time for FLD 9.36518 ms.
Elapsed time for FLD 9.54557 ms.
Elapsed time for FLD 9.36083 ms.
Elapsed time for FLD 8.89453 ms.
Elapsed time for FLD 8.95119 ms.
Elapsed time for FLD 9.19344 ms.
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../01-obj_detect/" title="01-物体检测概述" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                01-物体检测概述
              </span>
            </div>
          </a>
        
        
          <a href="../03-box_detect/" title="03-牙膏盒检测" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                03-牙膏盒检测
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href="https://www.czxy.com/">传智专修学院</a> 版权所有 2006 - 2020 江苏传智播客教育科技股份有限公司  学校地址：江苏省宿迁市沭阳县北京南路6号  邮编：223600   <a href="http://www.beian.miit.gov.cn/">苏ICP备16007882号-4</a>
          </div>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
        <script src="../../js/extra.js"></script>
      
        <script src="https://lib.baomitu.com/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../js/baidu-tongji.js"></script>
      
        <script src="../../js/baidu-tuisong.js"></script>
      
    
  </body>
</html>